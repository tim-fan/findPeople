<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      html, body { height: 100%; margin: 0; padding: 0; }
      #map { height: 100%; }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script type="text/javascript">

var map;
var marker;
var lat;
var lon;
var userLocations;
var currentLocation;
var markers = [];
$.getJSON("/findPeople/userLocations/", function(result){
    lat = result.locations[0].lat;
    lon = result.locations[0].lon;
    userLocations = result.locations;
});
function saveCurrentPosition(position){
  currentLocation = {lat:position.coords.latitude, lon:position.coords.longitude}
  console.log('Saving current position. Initial num markers: ' + markers.length);
  markers.push(newMarker(currentLocation));
  console.log('Saved current position. Final num markers: ' + markers.length);
  updateMapBounds();
}

function initMap() {
  //lat = {{lat}}
  //lon = {{lon}}
  
  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: lat, lng: lon},
    zoom: 8
  });
  newMarker = function(position) {
    latlon = new google.maps.LatLng(position.lat, position.lon);
    return new google.maps.Marker({position:latlon,map:map,title:"You are not here!"})
  }; 
  //latlon = new google.maps.LatLng(lat, lon)
  //marker = new google.maps.Marker({position:latlon,map:map,title:"You are here!"});
  markers = markers.concat(userLocations.map(newMarker));
  navigator.geolocation.getCurrentPosition(saveCurrentPosition)
  //while (currentLocation == null) {}
  console.log(markers.length);
  console.log('test');
  console.log(2);
  updateMapBounds();
}
function updateMapBounds() {
  var bounds = new google.maps.LatLngBounds();
  for (var i = 0; i < markers.length; i++) {
    bounds.extend(markers[i].getPosition());
  }

  map.fitBounds(bounds);
  numMarkers = markers.length;
  console.log('updated map bounds with ' + numMarkers.toString() + ' markers')
}

    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?callback=initMap">
    </script>
  </body>
</html>
